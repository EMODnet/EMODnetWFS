<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EQCL feature filtering • EMODnetWFS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="EQCL feature filtering">
<meta property="og:description" content="EMODnetWFS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EMODnetWFS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/emodnetwfs.html">emodnetwfs</a>
    </li>
    <li>
      <a href="../articles/eqcl_filtering.html">EQCL feature filtering</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EMODnet/EMODnetWFS/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="eqcl_filtering_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>EQCL feature filtering</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EMODnet/EMODnetWFS/blob/master/vignettes/eqcl_filtering.Rmd"><code>vignettes/eqcl_filtering.Rmd</code></a></small>
      <div class="hidden name"><code>eqcl_filtering.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EMODnet/EMODnetWFS">EMODnetWFS</a></span><span class="op">)</span></code></pre></div>
<div id="filtering-by-attributes" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-by-attributes" class="anchor"></a>Filtering by attributes</h2>
<p>However, by using WFS services you can request some analysis to be performed in the EMODnet servers. For example: using <a href="https://docs.geoserver.org/stable/en/user/tutorials/cql/cql_tutorial.html">CQL filters</a>, you can send a query that will occur on the server side. Only the information you need will be send back.</p>
<p>Rethinking the case before where we downloaded all the european maritime boundaries and later we filtered only the Territorial Seas, we could have retrieved directly the Territorial Seas.</p>
<p>First, we start a new WFS client with <code>emodnet_init_wfs_client</code></p>
<div id="inspecting-attributes" class="section level3">
<h3 class="hasAnchor">
<a href="#inspecting-attributes" class="anchor"></a>Inspecting attributes</h3>
<p>Before developing filters,</p>
<p>To start, you might want to know the names of a layer’s attributes.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_init_wfs_client.html">emodnet_init_wfs_client</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"human_activities"</span><span class="op">)</span>
<span class="co">#&gt; Loading ISO 19139 XML schemas...</span>
<span class="co">#&gt; Loading ISO 19115 codelists...</span>
<span class="co">#&gt; Loading IANA mime types...</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; ✔ WFS client created succesfully</span>
<span class="co">#&gt; ℹ Service: 'https://ows.emodnet-humanactivities.eu/wfs'</span>
<span class="co">#&gt; ℹ Version: '2.0.0'</span>
<span class="fu"><a href="../reference/layer_attributes_get_names.html">layer_attributes_get_names</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"maritimebnds"</span><span class="op">)</span>
<span class="co">#&gt;  [1] "objectid"   "mblszotpid" "localid"    "sitename"   "legalfound"</span>
<span class="co">#&gt;  [6] "legalfou_1" "country"    "nationalle" "nutscode"   "mblsds_mbl"</span>
<span class="co">#&gt; [11] "shape_leng" "the_geom"</span></code></pre></div>
<p>All functions can also be used by providing a service name instead of a <code>wfs</code> object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attributes_get_names.html">layer_attributes_get_names</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"human_activities"</span>, layer <span class="op">=</span> <span class="st">"maritimebnds"</span><span class="op">)</span>
<span class="co">#&gt; ✔ WFS client created succesfully</span>
<span class="co">#&gt; ℹ Service: 'https://ows.emodnet-humanactivities.eu/wfs'</span>
<span class="co">#&gt; ℹ Version: '2.0.0'</span>
<span class="co">#&gt;  [1] "objectid"   "mblszotpid" "localid"    "sitename"   "legalfound"</span>
<span class="co">#&gt;  [6] "legalfou_1" "country"    "nationalle" "nutscode"   "mblsds_mbl"</span>
<span class="co">#&gt; [11] "shape_leng" "the_geom"</span></code></pre></div>
<p>The type of filtering you might want to apply will depend on the data type of each attribute.</p>
<p>You can inspect attribute descriptions (metadata) for a given layer with <code><a href="../reference/layer_attribute_descriptions.html">layer_attribute_descriptions()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attribute_descriptions.html">layer_attribute_descriptions</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"maritimebnds"</span><span class="op">)</span>
<span class="co">#&gt;          name      type minOccurs maxOccurs nillable</span>
<span class="co">#&gt; 1    objectid   numeric         0         1     TRUE</span>
<span class="co">#&gt; 2  mblszotpid   integer         0         1     TRUE</span>
<span class="co">#&gt; 3     localid   numeric         0         1     TRUE</span>
<span class="co">#&gt; 4    sitename character         0         1     TRUE</span>
<span class="co">#&gt; 5  legalfound      Date         0         1     TRUE</span>
<span class="co">#&gt; 6  legalfou_1 character         0         1     TRUE</span>
<span class="co">#&gt; 7     country character         0         1     TRUE</span>
<span class="co">#&gt; 8  nationalle character         0         1     TRUE</span>
<span class="co">#&gt; 9    nutscode character         0         1     TRUE</span>
<span class="co">#&gt; 10 mblsds_mbl character         0         1     TRUE</span>
<span class="co">#&gt; 11 shape_leng    double         0         1     TRUE</span>
<span class="co">#&gt; 12   the_geom  geometry         0         1     TRUE</span></code></pre></div>
<p>and get summaries of the values in of each attribute with <code><a href="../reference/layer_attributes_summarise.html">layer_attributes_summarise()</a></code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attributes_summarise.html">layer_attributes_summarise</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"maritimebnds"</span><span class="op">)</span>
<span class="co">#&gt;     gml_id             objectid        mblszotpid      localid       </span>
<span class="co">#&gt;  Length:1048        Min.   :   1.0   Min.   :0.00   Min.   :    0.0  </span>
<span class="co">#&gt;  Class :character   1st Qu.: 262.8   1st Qu.:0.00   1st Qu.:  346.8  </span>
<span class="co">#&gt;  Mode  :character   Median : 524.5   Median :1.00   Median : 1745.5  </span>
<span class="co">#&gt;                     Mean   : 524.5   Mean   :1.73   Mean   : 9188.8  </span>
<span class="co">#&gt;                     3rd Qu.: 786.2   3rd Qu.:3.00   3rd Qu.: 3751.2  </span>
<span class="co">#&gt;                     Max.   :1048.0   Max.   :7.00   Max.   :62595.0  </span>
<span class="co">#&gt;                                                                      </span>
<span class="co">#&gt;    sitename           legalfound          legalfou_1          country         </span>
<span class="co">#&gt;  Length:1048        Min.   :1932-01-30   Length:1048        Length:1048       </span>
<span class="co">#&gt;  Class :character   1st Qu.:1984-11-09   Class :character   Class :character  </span>
<span class="co">#&gt;  Mode  :character   Median :2004-12-06   Mode  :character   Mode  :character  </span>
<span class="co">#&gt;                     Mean   :1999-11-21                                        </span>
<span class="co">#&gt;                     3rd Qu.:2012-12-26                                        </span>
<span class="co">#&gt;                     Max.   :2019-09-29                                        </span>
<span class="co">#&gt;                     NA's   :221                                               </span>
<span class="co">#&gt;   nationalle          nutscode          mblsds_mbl          shape_leng       </span>
<span class="co">#&gt;  Length:1048        Length:1048        Length:1048        Min.   :   0.0000  </span>
<span class="co">#&gt;  Class :character   Class :character   Class :character   1st Qu.:   0.0829  </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Mode  :character   Median :   0.5562  </span>
<span class="co">#&gt;                                                           Mean   :  13.3026  </span>
<span class="co">#&gt;                                                           3rd Qu.:   4.1102  </span>
<span class="co">#&gt;                                                           Max.   :1804.3286  </span>
<span class="co">#&gt; </span></code></pre></div>
</div>
<div id="filtering-categorical-attributes-values" class="section level3">
<h3 class="hasAnchor">
<a href="#filtering-categorical-attributes-values" class="anchor"></a>Filtering categorical attributes values</h3>
<p>We can filter features using categorical attributes. We might want to start by inspecting the available values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attribute_inspect.html">layer_attribute_inspect</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"maritimebnds"</span>, attribute <span class="op">=</span> <span class="st">"sitename"</span><span class="op">)</span>
<span class="co">#&gt;                                                         .   n    percent</span>
<span class="co">#&gt;                                                  Baseline 486 0.46374046</span>
<span class="co">#&gt;                                   Contiguous zone (24 nm)  65 0.06202290</span>
<span class="co">#&gt;                                         Continental Shelf  78 0.07442748</span>
<span class="co">#&gt;                          Delimitation line between states 212 0.20229008</span>
<span class="co">#&gt;                      Exclusive Economic Zone (200 nm) EEZ  68 0.06488550</span>
<span class="co">#&gt;        Exclusive Economic Zone (200 nm) EEZ - Median Line  23 0.02194656</span>
<span class="co">#&gt;  Exclusive Economic Zone (200 nm) EEZ - Overlapping claim  14 0.01335878</span>
<span class="co">#&gt;                                           Internal waters  38 0.03625954</span>
<span class="co">#&gt;                                     Territory sea (12 nm)  64 0.06106870</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attribute_inspect.html">layer_attribute_inspect</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"maritimebnds"</span>, attribute <span class="op">=</span> <span class="st">"sitename"</span><span class="op">)</span>
<span class="co">#&gt;                                                         .   n    percent</span>
<span class="co">#&gt;                                                  Baseline 486 0.46374046</span>
<span class="co">#&gt;                                   Contiguous zone (24 nm)  65 0.06202290</span>
<span class="co">#&gt;                                         Continental Shelf  78 0.07442748</span>
<span class="co">#&gt;                          Delimitation line between states 212 0.20229008</span>
<span class="co">#&gt;                      Exclusive Economic Zone (200 nm) EEZ  68 0.06488550</span>
<span class="co">#&gt;        Exclusive Economic Zone (200 nm) EEZ - Median Line  23 0.02194656</span>
<span class="co">#&gt;  Exclusive Economic Zone (200 nm) EEZ - Overlapping claim  14 0.01335878</span>
<span class="co">#&gt;                                           Internal waters  38 0.03625954</span>
<span class="co">#&gt;                                     Territory sea (12 nm)  64 0.06106870</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attributes_tbl.html">layer_attributes_tbl</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"longdistancefleet"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 10</span>
<span class="co">#&gt;   gml_id     gid legalfound legalfou_1   country namespace  nationalle nutscode </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt; &lt;date&gt;     &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;    </span>
<span class="co">#&gt; 1 longdis…    13 2007-03-28 http://eur-… &lt;NA&gt;    Long Dist… Internati… BE, DK, …</span>
<span class="co">#&gt; # … with 2 more variables: members &lt;chr&gt;, url &lt;chr&gt;</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span><span class="va">wfs</span>, layers <span class="op">=</span> <span class="st">"maritimebnds"</span>, 
                   cql_filter <span class="op">=</span> <span class="st">"sitename='Territory sea (12 nm)'"</span> <span class="op">)</span>
<span class="co">#&gt; $maritimebnds</span>
<span class="co">#&gt; Simple feature collection with 64 features and 12 fields</span>
<span class="co">#&gt; Geometry type: MULTICURVE</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -178.3897 ymin: -50.21866 xmax: 169.1762 ymax: 83.8746</span>
<span class="co">#&gt; CRS:           +init=epsg:4326</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;             gml_id objectid mblszotpid localid              sitename legalfound</span>
<span class="co">#&gt; 1  maritimebnds.49       49          1   49024 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 2  maritimebnds.58       58          1   49064 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 3  maritimebnds.59       59          1   49065 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 4  maritimebnds.60       60          1   49066 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 5  maritimebnds.61       61          1   49087 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 6  maritimebnds.62       62          1   49099 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 7  maritimebnds.54       54          1   49034 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 8  maritimebnds.55       55          1   49036 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 9  maritimebnds.56       56          1   49042 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 10 maritimebnds.57       57          1   49063 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt;    legalfou_1        country nationalle nutscode               mblsds_mbl</span>
<span class="co">#&gt; 1        &lt;NA&gt;         Latvia       &lt;NA&gt;       LV In www.marineregions.org</span>
<span class="co">#&gt; 2        &lt;NA&gt;         France       &lt;NA&gt;       FR In www.marineregions.org</span>
<span class="co">#&gt; 3        &lt;NA&gt;         France       &lt;NA&gt;       FR In www.marineregions.org</span>
<span class="co">#&gt; 4        &lt;NA&gt;         France       &lt;NA&gt;       FR In www.marineregions.org</span>
<span class="co">#&gt; 5        &lt;NA&gt;          Spain       &lt;NA&gt;       ES In www.marineregions.org</span>
<span class="co">#&gt; 6        &lt;NA&gt;         Cyprus       &lt;NA&gt;       CY In www.marineregions.org</span>
<span class="co">#&gt; 7        &lt;NA&gt;         Sweden       &lt;NA&gt;       SE In www.marineregions.org</span>
<span class="co">#&gt; 8        &lt;NA&gt; United Kingdom       &lt;NA&gt;       UK In www.marineregions.org</span>
<span class="co">#&gt; 9        &lt;NA&gt;         France       &lt;NA&gt;       FR In www.marineregions.org</span>
<span class="co">#&gt; 10       &lt;NA&gt;         France       &lt;NA&gt;       FR In www.marineregions.org</span>
<span class="co">#&gt;    shape_leng                       the_geom</span>
<span class="co">#&gt; 1   12.005746 MULTICURVE (LINESTRING (23....</span>
<span class="co">#&gt; 2    1.949563 MULTICURVE (LINESTRING (42....</span>
<span class="co">#&gt; 3    2.072975 MULTICURVE (LINESTRING (39....</span>
<span class="co">#&gt; 4    1.837879 MULTICURVE (LINESTRING (40....</span>
<span class="co">#&gt; 5   27.878496 MULTICURVE (LINESTRING (-17...</span>
<span class="co">#&gt; 6   13.642806 MULTICURVE (LINESTRING (34....</span>
<span class="co">#&gt; 7   68.013014 MULTICURVE (LINESTRING (19....</span>
<span class="co">#&gt; 8  141.545470 MULTICURVE (LINESTRING (-13...</span>
<span class="co">#&gt; 9   70.017156 MULTICURVE (LINESTRING (169...</span>
<span class="co">#&gt; 10   5.116398 MULTICURVE (LINESTRING (55....</span></code></pre></div>
</div>
<div id="using-or-and-and-staments" class="section level3">
<h3 class="hasAnchor">
<a href="#using-or-and-and-staments" class="anchor"></a>Using <code>OR</code> and <code>AND</code> staments</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sitename_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span><span class="va">wfs</span>, layers <span class="op">=</span> <span class="st">"maritimebnds"</span>, 
                   cql_filter <span class="op">=</span> <span class="st">"sitename='Territory sea (12 nm)' OR sitename='Exclusive Economic Zone (200 nm) EEZ'"</span>, 
                   reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sitename_filtered</span><span class="op">$</span><span class="va">sitename</span><span class="op">)</span>
<span class="co">#&gt; [1] "Territory sea (12 nm)"               </span>
<span class="co">#&gt; [2] "Exclusive Economic Zone (200 nm) EEZ"</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span><span class="va">wfs</span>, layers <span class="op">=</span> <span class="st">"maritimebnds"</span>, 
                   cql_filter <span class="op">=</span> <span class="st">"sitename='Territory sea (12 nm)' AND country='France'"</span>, 
                   reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 18 features and 12 fields</span>
<span class="co">#&gt; Geometry type: MULTICURVE</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -178.3897 ymin: -50.21866 xmax: 169.1762 ymax: 51.26491</span>
<span class="co">#&gt; CRS:           +init=epsg:4326</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;             gml_id objectid mblszotpid localid              sitename legalfound</span>
<span class="co">#&gt; 1  maritimebnds.58       58          1   49064 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 2  maritimebnds.59       59          1   49065 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 3  maritimebnds.60       60          1   49066 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 4  maritimebnds.56       56          1   49042 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 5  maritimebnds.57       57          1   49063 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 6  maritimebnds.45       45          1   49018 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 7  maritimebnds.66       66          1   49106 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 8  maritimebnds.67       67          1   49107 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 9  maritimebnds.68       68          1   49108 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt; 10 maritimebnds.69       69          1   49121 Territory sea (12 nm)       &lt;NA&gt;</span>
<span class="co">#&gt;    legalfou_1 country nationalle nutscode               mblsds_mbl shape_leng</span>
<span class="co">#&gt; 1        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org   1.949563</span>
<span class="co">#&gt; 2        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org   2.072975</span>
<span class="co">#&gt; 3        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org   1.837879</span>
<span class="co">#&gt; 4        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org  70.017156</span>
<span class="co">#&gt; 5        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org   5.116398</span>
<span class="co">#&gt; 6        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org  65.577172</span>
<span class="co">#&gt; 7        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org   8.157558</span>
<span class="co">#&gt; 8        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org   3.691194</span>
<span class="co">#&gt; 9        &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org  13.821110</span>
<span class="co">#&gt; 10       &lt;NA&gt;  France       &lt;NA&gt;       FR In www.marineregions.org   1.568862</span>
<span class="co">#&gt;                          the_geom</span>
<span class="co">#&gt; 1  MULTICURVE (LINESTRING (42....</span>
<span class="co">#&gt; 2  MULTICURVE (LINESTRING (39....</span>
<span class="co">#&gt; 3  MULTICURVE (LINESTRING (40....</span>
<span class="co">#&gt; 4  MULTICURVE (LINESTRING (169...</span>
<span class="co">#&gt; 5  MULTICURVE (LINESTRING (55....</span>
<span class="co">#&gt; 6  MULTICURVE (LINESTRING (9.6...</span>
<span class="co">#&gt; 7  MULTICURVE (LINESTRING (51....</span>
<span class="co">#&gt; 8  MULTICURVE (LINESTRING (77....</span>
<span class="co">#&gt; 9  MULTICURVE (LINESTRING (69....</span>
<span class="co">#&gt; 10 MULTICURVE (LINESTRING (-10...</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_init_wfs_client.html">emodnet_init_wfs_client</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"geology_seabed_substrate_maps"</span><span class="op">)</span>
<span class="co">#&gt; ✔ WFS client created succesfully</span>
<span class="co">#&gt; ℹ Service: 'https://drive.emodnet-geology.eu/geoserver/gtk/wfs'</span>
<span class="co">#&gt; ℹ Version: '2.0.0'</span>
<span class="va">filter_sf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>wfs <span class="op">=</span> <span class="va">wfs</span>, layers <span class="op">=</span> <span class="st">"seabed_substrate_1m"</span>,
                       cql_filter <span class="op">=</span> <span class="st">"country='Baltic Sea' OR country='Bulgaria' AND shape_length&gt;1"</span>,
                       reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span>
<span class="va">filter_sf1</span>
<span class="co">#&gt; Simple feature collection with 14 features and 30 fields</span>
<span class="co">#&gt; Geometry type: MULTISURFACE</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 4486837 ymin: 1897776 xmax: 5658431 ymax: 3690069</span>
<span class="co">#&gt; CRS:           +init=epsg:3034</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;                     gml_id  id objectid   code  country  data_holder</span>
<span class="co">#&gt; 1   seabed_substrate_1m.48  48       48 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 2  seabed_substrate_1m.108 108      108 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 3   seabed_substrate_1m.56  56       56 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 4   seabed_substrate_1m.60  60       60 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 5   seabed_substrate_1m.61  61       61 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 6   seabed_substrate_1m.64  64       64 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 7   seabed_substrate_1m.65  65       65 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 8   seabed_substrate_1m.69  69       69 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 9   seabed_substrate_1m.66  66       66 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt; 10  seabed_substrate_1m.91  91       91 BG-001 Bulgaria IO-BAS, MOEW</span>
<span class="co">#&gt;           contact   scale original_scale original_grain_size</span>
<span class="co">#&gt; 1  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 2  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 3  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 4  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 5  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 6  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 7  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 8  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 9  geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt; 10 geos@io-bas.bg 1000000              0          BNS-676.85</span>
<span class="co">#&gt;                                                                                                    references</span>
<span class="co">#&gt; 1  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 2  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 3  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 4  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 5  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 6  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 7  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 8  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 9  Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt; 10 Kojuharov et al., 2009, Geological map of Seabed sediments of Bulgarian EEZ in scale 1:500000, Sofia, MOEW</span>
<span class="co">#&gt;       comments reclassification method sample_number</span>
<span class="co">#&gt; 1  Public data                2      4             0</span>
<span class="co">#&gt; 2  Public data                2      4             0</span>
<span class="co">#&gt; 3  Public data                2      4             0</span>
<span class="co">#&gt; 4  Public data                2      4             0</span>
<span class="co">#&gt; 5  Public data                2      4             0</span>
<span class="co">#&gt; 6  Public data                2      4             0</span>
<span class="co">#&gt; 7  Public data                2      4             0</span>
<span class="co">#&gt; 8  Public data                2      4             0</span>
<span class="co">#&gt; 9  Public data                2      4             0</span>
<span class="co">#&gt; 10 Public data                2      4             0</span>
<span class="co">#&gt;                                    original_substrate relation folk_16cl</span>
<span class="co">#&gt; 1                   Local Lithostratigraphyc unit A-D        5         6</span>
<span class="co">#&gt; 2         Undefined coastal sands, rocks and boulders        5         6</span>
<span class="co">#&gt; 3            Local Lithostratigraphyc unit Ia-breccia        5         6</span>
<span class="co">#&gt; 4  Local Lithostratigraphyc unit Ia-carbonate-biogeni        5         6</span>
<span class="co">#&gt; 5               Local Lithostratigraphyc unit Ia-clay        5         6</span>
<span class="co">#&gt; 6               Local Lithostratigraphyc unit Ia-clay        5         6</span>
<span class="co">#&gt; 7               Local Lithostratigraphyc unit Ia-clay        5         6</span>
<span class="co">#&gt; 8               Local Lithostratigraphyc unit Ia-clay        5         6</span>
<span class="co">#&gt; 9               Local Lithostratigraphyc unit Ia-clay        5         6</span>
<span class="co">#&gt; 10                  Local Lithostratigraphyc unit K-H        5         6</span>
<span class="co">#&gt;               folk_16cl_txt folk_7cl      folk_7cl_txt folk_5cl</span>
<span class="co">#&gt; 1  6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt; 2  6. No data at this level        2           2. Sand        2</span>
<span class="co">#&gt; 3  6. No data at this level        4 4. Mixed sediment        4</span>
<span class="co">#&gt; 4  6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt; 5  6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt; 6  6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt; 7  6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt; 8  6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt; 9  6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt; 10 6. No data at this level       11          11. Mud         1</span>
<span class="co">#&gt;            folk_5cl_txt surface_feature conf_rs conf_s conf_d conf_tot</span>
<span class="co">#&gt; 1  1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt; 2              2. Sand                       NA     NA     NA       NA</span>
<span class="co">#&gt; 3     4. Mixed sediment                      NA     NA     NA       NA</span>
<span class="co">#&gt; 4  1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt; 5  1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt; 6  1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt; 7  1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt; 8  1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt; 9  1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt; 10 1. Mud to muddy Sand                      NA     NA     NA       NA</span>
<span class="co">#&gt;    shape_length shape_area                           geom</span>
<span class="co">#&gt; 1      7.378181 0.56731575 MULTISURFACE (POLYGON ((545...</span>
<span class="co">#&gt; 2      2.629942 0.01482684 MULTISURFACE (POLYGON ((540...</span>
<span class="co">#&gt; 3      1.155024 0.07369632 MULTISURFACE (POLYGON ((550...</span>
<span class="co">#&gt; 4     14.483235 1.96871269 MULTISURFACE (POLYGON ((546...</span>
<span class="co">#&gt; 5      1.425905 0.04474783 MULTISURFACE (POLYGON ((546...</span>
<span class="co">#&gt; 6      1.956767 0.06223765 MULTISURFACE (POLYGON ((561...</span>
<span class="co">#&gt; 7      2.528585 0.11428307 MULTISURFACE (POLYGON ((553...</span>
<span class="co">#&gt; 8      1.856806 0.02172805 MULTISURFACE (POLYGON ((553...</span>
<span class="co">#&gt; 9      3.640578 0.09411611 MULTISURFACE (POLYGON ((548...</span>
<span class="co">#&gt; 10     7.833991 0.44711025 MULTISURFACE (POLYGON ((554...</span></code></pre></div>
<p>The query returns features where <code>country</code> is <code>Baltic Sea</code> and <code>Bulgaria</code> but we can see that the minimum value is below the minimum we set with our filter. That’s because the <code>AND</code> filter is added only to the <code>country='Bulgaria'</code>, so while only features with <code>shape_length &gt; 1</code> are returned where <code>country</code> is also <code>Bulgaria</code>, the filter is not applied to <code>shape_length</code> where <code>country</code> is <code>Baltic Sea</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">filter_sf1</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>
<span class="co">#&gt; [1] "Bulgaria"   "Baltic Sea"</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">filter_sf1</span><span class="op">$</span><span class="va">shape_length</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2962585</span></code></pre></div>
<p>To add the <code>AND</code> filter to both <code>OR</code> filters, we can use a parenthesis:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filter_sf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>wfs <span class="op">=</span> <span class="va">wfs</span>, layers <span class="op">=</span> <span class="st">"seabed_substrate_1m"</span>,
                       cql_filter <span class="op">=</span> <span class="st">"(country='Baltic Sea' OR country='Bulgaria') AND shape_length&gt;1"</span>,
                       reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></code></pre></div>
<p>Now the minimum value is indeed above 1. However, we only get features where <code>country</code> is <code>'Bulgaria'</code>. That’s because the single <code>Baltic Sea</code> feature had a <code>shape_length</code> value smaller than 1 so is filtered out.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">filter_sf2</span><span class="op">$</span><span class="va">shape_length</span><span class="op">)</span>
<span class="co">#&gt; [1] 1.155024</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">filter_sf2</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>
<span class="co">#&gt; [1] "Bulgaria"</span></code></pre></div>
<p>Finally filtering for <code>shape_length &lt; 1</code> returns features with <code>shape_length</code> values smaller than 1 for both <code>country</code> values.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filter_sf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>wfs <span class="op">=</span> <span class="va">wfs</span>, layers <span class="op">=</span> <span class="st">"seabed_substrate_1m"</span>,
                       cql_filter <span class="op">=</span> <span class="st">"(country='Baltic Sea' OR country='Bulgaria') AND shape_length&lt;1"</span>,
                       reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">filter_sf3</span><span class="op">$</span><span class="va">shape_length</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.7606257</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">filter_sf3</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>
<span class="co">#&gt; [1] "Bulgaria"   "Baltic Sea"</span></code></pre></div>
</div>
<div id="advanced-use" class="section level3">
<h3 class="hasAnchor">
<a href="#advanced-use" class="anchor"></a>Advanced use</h3>
<p>There is more that can accomplished by using the EMODnet WFS services than downloading data. The EMODnetWFS package is built on top of the <a href="https://github.com/eblondel/ows4R">ows4R</a> library, meaning that all the functionalities of this package are available for EMODnetWFS. The ows4R returns a special type of R object called R6. You can learn more in Hadley Wickham’s chapter on R6 Objects of the <a href="https://adv-r.hadley.nz/r6.html">Advance R book</a>.</p>
<p>For instance: it is not efficient to read a large dataset into R just and later subset part of it. This requires longer waiting times and more bandwidth usage, and in very large datasets it would simply not be possible. For instance, all the occurrences data available through the EMODnet Biology portal are stored in <a href="https://www.emodnet-biology.eu/emodnet-data-format">one table</a>: These are approximately 30 millions rows! In this case, we suggest you access the EMODnet Biology occurrence data through the <a href="https://www.emodnet-biology.eu/toolbox/">download toolbox</a> or the <a href="https://github.com/lifewatch/eurobis/">eurobis R package</a> instead.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Anna Krystalli, Salvador Fernández-Bejarano, VLIZ (VLAAMS INSTITUUT VOOR DE ZEE).</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
