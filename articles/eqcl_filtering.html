<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EMODnetWFS">
<title>EQCL feature filtering • EMODnetWFS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EQCL feature filtering">
<meta property="og:description" content="EMODnetWFS">
<meta property="og:image" content="https://emodnet.github.io/EMODnetWFS/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EMODnetWFS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/emodnetwfs.html">EMODnetWFS Case Study: Accessing and mapping EMODnet data</a>
    <a class="dropdown-item" href="../articles/eqcl_filtering.html">EQCL feature filtering</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EMODnet/EMODnetWFS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>EQCL feature filtering</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EMODnet/EMODnetWFS/blob/HEAD/vignettes/eqcl_filtering.Rmd" class="external-link"><code>vignettes/eqcl_filtering.Rmd</code></a></small>
      <div class="d-none name"><code>eqcl_filtering.Rmd</code></div>
    </div>

    
    
<p>So far, we’ve demonstrated using <code>EMODnetWFS</code> to request complete layers.</p>
<p>However, WFS services allows us to be selective with what features are returned from the EMODnet servers. For example: using <a href="https://docs.geoserver.org/stable/en/user/tutorials/cql/cql_tutorial.html" class="external-link">CQL filters</a>, we can send a query including a filtering clause that will be executed on the server and return only the subset of the information we request. This can make queries a lot faster and reduce the need for filtering data after download.</p>
<p>For example, let’s consider the case where we want to include the territorial sea boundaries in a habitat map.<br>
One way to approach this would be to download the full layer containing all the European maritime boundaries from the human activities service and then filter the <code>sf</code> object returned for features representing Territorial Seas.</p>
<p>A more efficient approach would be to use a filter and request only the features representing Territorial Seas from the server. Let’s have a look at how to do that.</p>
<div class="section level3">
<h3 id="cql-ecql-query-languages-">CQL &amp; ECQL Query languages.<a class="anchor" aria-label="anchor" href="#cql-ecql-query-languages-"></a>
</h3>
<p>CQL (Common Query Language) is a plain-text language created for the OGC Catalog specification. GeoServer has adapted it to be an easy-to-use filtering mechanism. GeoServer actually implements a more powerful extension called ECQL (Extended CQL), which allows expressing the full range of filters that OGC Filter 1.1 can encode. ECQL is accepted in many places in GeoServer.</p>
<p>GeoServer supports the use of both CQL and ECQL in WFS requests and whenever the documentation refers to CQL, ECQL syntax can be used as well.</p>
<div class="alert alert-info" role="alert">
<p>The examples provided here are only a small subset of filtering functionality available through Geoserver. Full references and further examples can be found in the following documentation:</p>
<ul>
<li><p><a href="https://docs.geoserver.org/latest/en/user/filter/ecql_reference.html" class="external-link">ECQL Reference</a>: reference for the syntax of the ECQL language.</p></li>
<li><p><a href="https://docs.geoserver.org/stable/en/user/filter/function_reference.html" class="external-link">Filter Function Reference</a>: The OGC Filter Encoding specification provides a generic concept of a filter function. A filter function is a named function with any number of arguments, which can be used in a filter expression to perform specific calculations. This provides much richer expressiveness for defining filters.GeoServer provides many different kinds of filter functions, covering a wide range of functionality including mathematics, string formatting, and geometric operations.</p></li>
<li><p><a href="https://docs.geoserver.org/stable/en/user/tutorials/cql/cql_tutorial.html" class="external-link">CQL and ECQL Tutorial</a> shows examples of defining filters.</p></li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="initialise-emodnet-wfs-client">Initialise EMODnet WFS client<a class="anchor" aria-label="anchor" href="#initialise-emodnet-wfs-client"></a>
</h3>
<p>First, let’s load the library and start a new WFS client with <code>emodnet_init_wfs_client</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EMODnet/EMODnetWFS" class="external-link">EMODnetWFS</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_init_wfs_client.html">emodnet_init_wfs_client</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"biology"</span><span class="op">)</span>
<span class="co">#&gt; Loading ISO 19139 XML schemas...</span>
<span class="co">#&gt; Loading ISO 19115 codelists...</span>
<span class="co">#&gt; Loading IANA mime types...</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> WFS client created succesfully</span>
<span class="co">#&gt; <span style="color: #BBBB00;">ℹ</span> Service: <span style="color: #0000BB;">'https://geo.vliz.be/geoserver/Emodnetbio/wfs'</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">ℹ</span> Version: <span style="color: #0000BB;">'2.0.0'</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspecting-attributes">Inspecting attributes<a class="anchor" aria-label="anchor" href="#inspecting-attributes"></a>
</h3>
<p>To develop filters, we first need information about the attributes we can filter on. For example, we might want to know the data type and range or distribution of values of each attributes of a given layer.</p>
<p>Let’s look at existing layers.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_wfs_info.html">emodnet_get_wfs_info</a></span><span class="op">(</span><span class="va">wfs</span><span class="op">)</span> 
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 31 × 9</span></span>
<span class="co">#&gt;    data_source service_name service_url         layer_namespace layer_name title</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      mediseh_c… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      mediseh_c… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      mediseh_c… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      Species_g… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      Species_g… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      Species_g… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      Species_g… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      mediseh_h… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      mediseh_m… EMOD…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> emodnet_wfs biology      https://geo.vliz.b… Emodnetbio      mediseh_m… EMOD…</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 21 more rows, and 3 more variables: abstract &lt;chr&gt;, class &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   format &lt;chr&gt;</span></span></code></pre></div>
<div class="section level4">
<h4 id="layer-attribute-names">Layer attribute names<a class="anchor" aria-label="anchor" href="#layer-attribute-names"></a>
</h4>
<p>To start, you might want to know the names of a layer’s attributes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attributes_get_names.html">layer_attributes_get_names</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span><span class="op">)</span>
<span class="co">#&gt; [1] "id"       "country"  "the_geom"</span></code></pre></div>
<p>All functions can also be used by providing a service name instead of a <code>wfs</code> object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attributes_get_names.html">layer_attributes_get_names</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"biology"</span>, layer <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> WFS client created succesfully</span>
<span class="co">#&gt; <span style="color: #BBBB00;">ℹ</span> Service: <span style="color: #0000BB;">'https://geo.vliz.be/geoserver/Emodnetbio/wfs'</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">ℹ</span> Version: <span style="color: #0000BB;">'2.0.0'</span></span>
<span class="co">#&gt; [1] "id"       "country"  "the_geom"</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="layer-attribute-descriptions">Layer attribute descriptions<a class="anchor" aria-label="anchor" href="#layer-attribute-descriptions"></a>
</h4>
<p>The type of filtering you might want to apply will depend on the data type of each attribute.</p>
<p>You can inspect attribute descriptions (metadata) for a given layer with <code><a href="../reference/layer_attribute_descriptions.html">layer_attribute_descriptions()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attribute_descriptions.html">layer_attribute_descriptions</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span><span class="op">)</span>
<span class="co">#&gt;       name      type minOccurs maxOccurs nillable</span>
<span class="co">#&gt; 1       id   integer         0         1     TRUE</span>
<span class="co">#&gt; 2  country character         0         1     TRUE</span>
<span class="co">#&gt; 3 the_geom  geometry         0         1     TRUE</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="layer-attribute-summaries">Layer attribute summaries<a class="anchor" aria-label="anchor" href="#layer-attribute-summaries"></a>
</h4>
<p>You can get summaries of the values of each attribute with <code><a href="../reference/layer_attributes_summarise.html">layer_attributes_summarise()</a></code>. This function basically runs <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the attribute columns of the layer.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attributes_summarise.html">layer_attributes_summarise</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span><span class="op">)</span>
<span class="co">#&gt;     gml_id                id      country         </span>
<span class="co">#&gt;  Length:54          Min.   :0   Length:54         </span>
<span class="co">#&gt;  Class :character   1st Qu.:0   Class :character  </span>
<span class="co">#&gt;  Mode  :character   Median :0   Mode  :character  </span>
<span class="co">#&gt;                     Mean   :0                     </span>
<span class="co">#&gt;                     3rd Qu.:0                     </span>
<span class="co">#&gt;                     Max.   :0</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="inspecting-individual-layer-attributes">Inspecting individual layer attributes<a class="anchor" aria-label="anchor" href="#inspecting-individual-layer-attributes"></a>
</h4>
<p>You can also inspect individual attributes which, in the case of categorical variables, can give more detailed information on the names and distribution of categories.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attribute_inspect.html">layer_attribute_inspect</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span>, attribute <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span>
<span class="co">#&gt;         .  n    percent</span>
<span class="co">#&gt;   Croazia  4 0.07407407</span>
<span class="co">#&gt;   Francia  1 0.01851852</span>
<span class="co">#&gt;    Italia 30 0.55555556</span>
<span class="co">#&gt;     Libia  2 0.03703704</span>
<span class="co">#&gt;  Slovenia  8 0.14814815</span>
<span class="co">#&gt;    Spagna  8 0.14814815</span>
<span class="co">#&gt;   Tunisia  1 0.01851852</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="layer-attributes-table">Layer attributes table<a class="anchor" aria-label="anchor" href="#layer-attributes-table"></a>
</h3>
<p>Finally, to enable full inspection and custom processing of attribute data, you can download the full set of attributes as a <code>data.frame</code>, excluding the geometry column. As the geometries are usually the largest column, this is much faster than downloading the full layer and can be useful in developing attribute filtering rules.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">attr_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/layer_attributes_tbl.html">layer_attributes_tbl</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span><span class="op">)</span>

<span class="va">attr_tbl</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 54 × 3</span></span>
<span class="co">#&gt;    gml_id                      id country</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> mediseh_zostera_m_pnt.1      0 Spagna </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> mediseh_zostera_m_pnt.2      0 Spagna </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> mediseh_zostera_m_pnt.3      0 Spagna </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> mediseh_zostera_m_pnt.4      0 Spagna </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> mediseh_zostera_m_pnt.5      0 Spagna </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> mediseh_zostera_m_pnt.6      0 Spagna </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> mediseh_zostera_m_pnt.7      0 Spagna </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> mediseh_zostera_m_pnt.8      0 Francia</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> mediseh_zostera_m_pnt.9      0 Italia </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> mediseh_zostera_m_pnt.10     0 Italia </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 44 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html" class="external-link">skim</a></span><span class="op">(</span><span class="va">attr_tbl</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">attr_tbl</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">54</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">gml_id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">23</td>
<td align="right">24</td>
<td align="right">0</td>
<td align="right">54</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">country</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">▁▁▇▁▁</td>
</tr></tbody>
</table>
</div>
<div class="section level2">
<h2 id="filtering-by-attributes">Filtering by attributes<a class="anchor" aria-label="anchor" href="#filtering-by-attributes"></a>
</h2>
<div class="section level3">
<h3 id="filtering-categorical-attributes-values-using-text-comparisons">Filtering categorical attributes values using text comparisons<a class="anchor" aria-label="anchor" href="#filtering-categorical-attributes-values-using-text-comparisons"></a>
</h3>
<p>Once we know the values of a categorical attribute of a layer, we can use them to filter the features returned from our query. For example, let’s say we are only interested in results for France. From our previous interrogation of the attributes associated with the <code>mediseh_zostera_m_pnt</code> layer, we have seen that the attribute <code>country</code> contains the country.</p>
<p>We can use the <strong>name of the attribute</strong> and the <strong>value</strong> we require to <strong>construct our eqcl filter</strong> and pass it to our request using the <code>cql_filter</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span>,
    cql_filter <span class="op">=</span> <span class="st">"country = 'Francia'"</span> 
<span class="op">)</span>
<span class="co">#&gt; $mediseh_zostera_m_pnt</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 4.84864 ymin: 43.37637 xmax: 4.84864 ymax: 43.37637</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;                    gml_id id country                 the_geom</span>
<span class="co">#&gt; 1 mediseh_zostera_m_pnt.8  0 Francia POINT (4.84864 43.37637)</span></code></pre></div>
<p>The above shows the most basic text comparisons we can make use the equality operator <code>=</code>. If we want to match more than one value, we can use the operator <code>IN</code> instead and provide a list of values to compare to. For example, to request both France and Spain, we could use the following filter:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span>, 
    cql_filter <span class="op">=</span> <span class="st">"country IN ('Francia', 'Spagna')"</span> 
<span class="op">)</span>
<span class="co">#&gt; $mediseh_zostera_m_pnt</span>
<span class="co">#&gt; Simple feature collection with 9 features and 3 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -4.167154 ymin: 36.71226 xmax: 4.84864 ymax: 43.37637</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;                     gml_id id country                   the_geom</span>
<span class="co">#&gt; 1  mediseh_zostera_m_pnt.1  0  Spagna  POINT (-2.61314 36.71681)</span>
<span class="co">#&gt; 2  mediseh_zostera_m_pnt.2  0  Spagna POINT (-3.846598 36.75127)</span>
<span class="co">#&gt; 3  mediseh_zostera_m_pnt.3  0  Spagna POINT (-3.957785 36.72266)</span>
<span class="co">#&gt; 4  mediseh_zostera_m_pnt.4  0  Spagna POINT (-4.039712 36.74217)</span>
<span class="co">#&gt; 5  mediseh_zostera_m_pnt.5  0  Spagna POINT (-4.100182 36.72331)</span>
<span class="co">#&gt; 6  mediseh_zostera_m_pnt.6  0  Spagna POINT (-4.167154 36.71226)</span>
<span class="co">#&gt; 7  mediseh_zostera_m_pnt.7  0  Spagna POINT (-1.268366 37.55797)</span>
<span class="co">#&gt; 8  mediseh_zostera_m_pnt.8  0 Francia   POINT (4.84864 43.37637)</span>
<span class="co">#&gt; 9 mediseh_zostera_m_pnt.54  0  Spagna  POINT (3.291868 42.29132)</span></code></pre></div>
<p>It is the same as using the <code>OR</code> filter:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span>, 
    cql_filter <span class="op">=</span> <span class="st">"country='Francia' OR country='Spagna')"</span>
<span class="op">)</span>
<span class="co">#&gt; Warning: Download of layer <span style="color: #0000BB;">'mediseh_zostera_m_pnt'</span> failed: <span style="color: #00BB00;">Error: Cannot open "/tmp/RtmpUIZqXq/file3d2d27ca106b.gml"; The source could be corrupt or not supported. See `st_drivers()` for a list of supported formats.</span></span>
<span class="co"><span style="color: #00BB00;">#&gt; </span></span>
<span class="co">#&gt; $mediseh_zostera_m_pnt</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>Other text comparisons include text pattern matching using operator <code>LIKE</code>. For example, to request maritime boundaries for countries starting with an <code>S</code>, we can use the following filter:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span>,
    cql_filter <span class="op">=</span> <span class="st">"country LIKE 'S%'"</span>,
                       reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 16 features and 3 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -4.167154 ymin: 36.71226 xmax: 13.73725 ymax: 45.58252</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;                      gml_id id  country                   the_geom</span>
<span class="co">#&gt; 1   mediseh_zostera_m_pnt.1  0   Spagna  POINT (-2.61314 36.71681)</span>
<span class="co">#&gt; 2   mediseh_zostera_m_pnt.2  0   Spagna POINT (-3.846598 36.75127)</span>
<span class="co">#&gt; 3   mediseh_zostera_m_pnt.3  0   Spagna POINT (-3.957785 36.72266)</span>
<span class="co">#&gt; 4   mediseh_zostera_m_pnt.4  0   Spagna POINT (-4.039712 36.74217)</span>
<span class="co">#&gt; 5   mediseh_zostera_m_pnt.5  0   Spagna POINT (-4.100182 36.72331)</span>
<span class="co">#&gt; 6   mediseh_zostera_m_pnt.6  0   Spagna POINT (-4.167154 36.71226)</span>
<span class="co">#&gt; 7   mediseh_zostera_m_pnt.7  0   Spagna POINT (-1.268366 37.55797)</span>
<span class="co">#&gt; 8  mediseh_zostera_m_pnt.39  0 Slovenia  POINT (13.73725 45.56948)</span>
<span class="co">#&gt; 9  mediseh_zostera_m_pnt.40  0 Slovenia  POINT (13.70701 45.58252)</span>
<span class="co">#&gt; 10 mediseh_zostera_m_pnt.41  0 Slovenia  POINT (13.71894 45.54535)</span></code></pre></div>
<p>CQL/ECQL filters can also include any of the <a href="https://docs.geoserver.org/stable/en/user/filter/function_reference.html#filter-function-reference" class="external-link">filter functions</a> available in GeoServer, including multiple <a href="https://docs.geoserver.org/stable/en/user/filter/function_reference.html#string-functions" class="external-link">string functions</a> which greatly increases the power of CQL expressions.</p>
<p>For example, we can request countries that contain <code>l</code> anywhere, including the first letter. To make the request case independent, we can turn <code>country</code> names to lowercase and then use a <code>like</code> comparison to a lowercase <code>l</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_zostera_m_pnt"</span>,
    cql_filter <span class="op">=</span> <span class="st">"strToLowerCase(country) LIKE '%l%'"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 40 features and 3 fields</span>
<span class="co">#&gt; Geometry type: POINT</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: 11.71682 ymin: 33.07782 xmax: 14.4714 ymax: 45.72451</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;                      gml_id id country                  the_geom</span>
<span class="co">#&gt; 1   mediseh_zostera_m_pnt.9  0  Italia POINT (13.71831 45.70017)</span>
<span class="co">#&gt; 2  mediseh_zostera_m_pnt.10  0  Italia POINT (13.16378 45.72451)</span>
<span class="co">#&gt; 3  mediseh_zostera_m_pnt.11  0  Italia POINT (13.35982 45.70508)</span>
<span class="co">#&gt; 4  mediseh_zostera_m_pnt.12  0  Italia POINT (12.26722 45.25975)</span>
<span class="co">#&gt; 5  mediseh_zostera_m_pnt.13  0  Italia   POINT (12.31285 45.362)</span>
<span class="co">#&gt; 6  mediseh_zostera_m_pnt.14  0  Italia POINT (12.53509 45.53269)</span>
<span class="co">#&gt; 7  mediseh_zostera_m_pnt.15  0  Italia  POINT (12.48269 45.5065)</span>
<span class="co">#&gt; 8  mediseh_zostera_m_pnt.16  0  Italia POINT (12.77334 43.96751)</span>
<span class="co">#&gt; 9  mediseh_zostera_m_pnt.17  0  Italia POINT (13.62604 43.50809)</span>
<span class="co">#&gt; 10 mediseh_zostera_m_pnt.18  0  Italia POINT (13.46398 43.60892)</span></code></pre></div>
<div class="section level4 alert alert-info" role="alert">
<h4 id="for-more-details-on-string-functions-consult-the-full-list-in-the-geoserver-function-reference-user-documentation-">For more details on string functions, consult the <a href="https://docs.geoserver.org/stable/en/user/filter/function_reference.html#string-functions" class="external-link">full list</a> in the geoserver function reference user documentation.**<a class="anchor" aria-label="anchor" href="#for-more-details-on-string-functions-consult-the-full-list-in-the-geoserver-function-reference-user-documentation-"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="filtering-numeric-variables">Filtering numeric variables<a class="anchor" aria-label="anchor" href="#filtering-numeric-variables"></a>
</h3>
<p>A number of additional <strong>comparison operators, such as =, <code>&lt;&gt;</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code></strong> , arithmetic operators <strong><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code></strong> as well as <strong><a href="https://docs.geoserver.org/stable/en/user/filter/function_reference.html#comparison-functions" class="external-link">comparison</a> and <a href="https://docs.geoserver.org/stable/en/user/filter/function_reference.html#comparison-functions" class="external-link">math</a> functions</strong> can be used for filtering numeric variables.</p>
<p>This time we’ll use the <strong>mediseh_posidonia_nodata</strong>.</p>
<p>We can inspect again use some of our interrogative functions to get information on layer attributes.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/layer_attributes_get_names.html">layer_attributes_get_names</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"mediseh_posidonia_nodata"</span><span class="op">)</span>
<span class="co">#&gt; [1] "id"       "km"       "the_geom"</span>

<span class="fu"><a href="../reference/layer_attribute_inspect.html">layer_attribute_inspect</a></span><span class="op">(</span><span class="va">wfs</span>, layer <span class="op">=</span> <span class="st">"mediseh_posidonia_nodata"</span>, attribute <span class="op">=</span> <span class="st">"km"</span><span class="op">)</span>
<span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span>
<span class="co">#&gt;   0.2371   6.0306  16.6190  40.1771  42.8958 472.9613</span></code></pre></div>
<p>We can see that values range between <code>0.23</code> and <code>~473</code> with a mean of <code>~40</code>.</p>
<p>Let’s say we are interested in values greater than <code>400</code>. We can use the operator <code>&gt;</code> to create our filter:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_posidonia_nodata"</span>,
    cql_filter <span class="op">=</span> <span class="st">"km &gt; 400"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 4 features and 3 fields</span>
<span class="co">#&gt; Geometry type: MULTICURVE</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -1.572609 ymin: 35.24538 xmax: 28.33243 ymax: 38.68017</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;                         gml_id id       km                       the_geom</span>
<span class="co">#&gt; 1   mediseh_posidonia_nodata.8  0 456.3759 MULTICURVE (LINESTRING (2.3...</span>
<span class="co">#&gt; 2 mediseh_posidonia_nodata.227  0 464.6573 MULTICURVE (LINESTRING (26....</span>
<span class="co">#&gt; 3 mediseh_posidonia_nodata.228  0 472.9613 MULTICURVE (LINESTRING (26....</span>
<span class="co">#&gt; 4 mediseh_posidonia_nodata.229  0 463.8207 MULTICURVE (LINESTRING (27....</span></code></pre></div>
<p>To request a range we can use filter functions <code>between</code> and <code>and</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_posidonia_nodata"</span>,
    cql_filter <span class="op">=</span> <span class="st">"km between 40 and 400"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 120 features and 3 fields</span>
<span class="co">#&gt; Geometry type: MULTICURVE</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -2.1798 ymin: 30.26623 xmax: 34.59127 ymax: 45.35511</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;                         gml_id id        km                       the_geom</span>
<span class="co">#&gt; 1   mediseh_posidonia_nodata.1  0 291.50323 MULTICURVE (LINESTRING (27....</span>
<span class="co">#&gt; 2   mediseh_posidonia_nodata.2  0  75.37950 MULTICURVE (LINESTRING (23....</span>
<span class="co">#&gt; 3   mediseh_posidonia_nodata.4  0 110.34480 MULTICURVE (LINESTRING (19....</span>
<span class="co">#&gt; 4  mediseh_posidonia_nodata.13  0  66.99746 MULTICURVE (LINESTRING (9.1...</span>
<span class="co">#&gt; 5   mediseh_posidonia_nodata.5  0 222.44651 MULTICURVE (LINESTRING (8.6...</span>
<span class="co">#&gt; 6   mediseh_posidonia_nodata.6  0  58.72822 MULTICURVE (LINESTRING (6.8...</span>
<span class="co">#&gt; 7   mediseh_posidonia_nodata.7  0 192.50519 MULTICURVE (LINESTRING (6.4...</span>
<span class="co">#&gt; 8  mediseh_posidonia_nodata.10  0  65.74354 MULTICURVE (LINESTRING (-1....</span>
<span class="co">#&gt; 9  mediseh_posidonia_nodata.11  0 138.68819 MULTICURVE (LINESTRING (4.8...</span>
<span class="co">#&gt; 10 mediseh_posidonia_nodata.17  0 184.05959 MULTICURVE (LINESTRING (10....</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filtering-with-spatial-predicates">Filtering with spatial predicates<a class="anchor" aria-label="anchor" href="#filtering-with-spatial-predicates"></a>
</h3>
<p>Another powerful option for filtering features is by using <a href="https://docs.geoserver.org/latest/en/user/filter/ecql_reference.html#spatial-predicate" class="external-link">spatial predicates</a></p>
<p>For example, we could use the <strong>ECQL spatial predicate <code>BBOX()</code></strong> to request only features that intersect a defined bounding box. Note that <code>geom</code> is the name of the attribute that contains feature geometries, <strong>coordinates are supplied in the sequence <code>xmin</code>, <code>xmax</code>, <code>ymin</code>, <code>ymax</code></strong> and the query default is to use the CRS of the queried layer unless an additional CRS argument is provided.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bbox_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"mediseh_posidonia_nodata"</span>,
    cql_filter <span class="op">=</span> <span class="st">"BBOX(geom, 2565427, 4026324, 1522239, 2778536)"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">map</span> <span class="op">&lt;-</span> <span class="va">bbox_filter</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"GEOMETRYCOLLECTION"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_collection_extract.html" class="external-link">st_collection_extract</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"POLYGON"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
<span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span>zcol <span class="op">=</span> <span class="st">"folk_7cl_txt"</span>, burst <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">map</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-or-and-and-statements">Using <code>OR</code> and <code>AND</code> statements<a class="anchor" aria-label="anchor" href="#using-or-and-and-statements"></a>
</h3>
<p>Filter conditions can also be a logical combination of other conditions using <code>AND</code>, <code>OR</code> or <code>NOT</code>. We showed previously how we could use a list of potential values to match an attribute to. This could also be achieved using an <code>OR</code> statement.</p>
<p>For example, the following query returns features where country is either <code>Baltic Sea</code> or <code>Bulgaria</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_init_wfs_client.html">emodnet_init_wfs_client</a></span><span class="op">(</span>service <span class="op">=</span> <span class="st">"geology_seabed_substrate_maps"</span><span class="op">)</span>
<span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"seabed_substrate_1m"</span>,
    cql_filter <span class="op">=</span> <span class="st">"country='Baltic Sea' OR country='Bulgaria'"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span></code></pre></div>
<p>Let’s say we also want to restrict the features returned those having <code>shape_length</code> &gt; 1. We can include an additional condition which must be met using an <code>AND</code> statement.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">filter_sf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"seabed_substrate_1m"</span>,
    cql_filter <span class="op">=</span> <span class="st">"country='Baltic Sea' OR country='Bulgaria' AND shape_length&gt;1"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span>
<span class="va">filter_sf1</span></code></pre></div>
<p>The query returns features where <code>country</code> is <code>Baltic Sea</code> or <code>Bulgaria</code> but we can see that the minimum value is below the minimum we set with our filter. That’s because the <code>AND</code> filter is added only to the <code>country='Bulgaria'</code>, so while only features with <code>shape_length &gt; 1</code> are returned where <code>country</code> is also <code>Bulgaria</code>, the filter is not applied to <code>shape_length</code> where <code>country</code> is <code>Baltic Sea</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">filter_sf1</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">filter_sf1</span><span class="op">$</span><span class="va">shape_length</span><span class="op">)</span></code></pre></div>
<p>To add the <code>AND</code> filter to both <code>OR</code> filters, we can use a parenthesis:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filter_sf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"seabed_substrate_1m"</span>,
    cql_filter <span class="op">=</span> <span class="st">"(country='Baltic Sea' OR country='Bulgaria') AND shape_length&gt;1"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span></code></pre></div>
<p>Now the minimum value is indeed above 1. However, we only get features where <code>country</code> is <code>'Bulgaria'</code>. That’s because the single <code>Baltic Sea</code> feature had a <code>shape_length</code> value smaller than 1 so is filtered out.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">filter_sf2</span><span class="op">$</span><span class="va">shape_length</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">filter_sf2</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></code></pre></div>
<p>Finally filtering for <code>shape_length &lt; 1</code> returns features with <code>shape_length</code> values smaller than 1 for both <code>country</code> values.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filter_sf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emodnet_get_layers.html">emodnet_get_layers</a></span><span class="op">(</span>
    wfs <span class="op">=</span> <span class="va">wfs</span>, 
    layers <span class="op">=</span> <span class="st">"seabed_substrate_1m"</span>,
    cql_filter <span class="op">=</span> <span class="st">"(country='Baltic Sea' OR country='Bulgaria') AND shape_length&lt;1"</span>,
    reduce_layers <span class="op">=</span> <span class="cn">TRUE</span> 
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">filter_sf3</span><span class="op">$</span><span class="va">shape_length</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">filter_sf3</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="advanced-use">Advanced use<a class="anchor" aria-label="anchor" href="#advanced-use"></a>
</h3>
<p>There is more that can accomplished by using the EMODnet WFS services than downloading data. The EMODnetWFS package is built on top of the <a href="https://github.com/eblondel/ows4R" class="external-link">ows4R</a> library, meaning that all the functionalities of this package are available for EMODnetWFS. The ows4R returns a special type of R object called R6. You can learn more in Hadley Wickham’s chapter on R6 Objects of the <a href="https://adv-r.hadley.nz/r6.html" class="external-link">Advance R book</a>.</p>
<p>For instance: it is not efficient to read a large dataset into R just and later subset part of it. This requires longer waiting times and more bandwidth usage, and in very large datasets it would simply not be possible. For instance, all the occurrences data available through the EMODnet Biology portal are stored in <a href="https://www.emodnet-biology.eu/emodnet-data-format" class="external-link">one table</a>: These are approximately 30 millions rows! In this case, we suggest you access the EMODnet Biology occurrence data through the <a href="https://www.emodnet-biology.eu/toolbox/" class="external-link">download toolbox</a> or the <a href="https://github.com/lifewatch/eurobis/" class="external-link">eurobis R package</a> instead.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Anna Krystalli, Salvador Fernández-Bejarano, VLIZ (VLAAMS INSTITUUT VOOR DE ZEE), Maëlle Salmon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
